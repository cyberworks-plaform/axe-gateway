@{
    ViewData["Title"] = "Dashboard";
}

<!-- Content Header (Page header) -->
<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-12">
                <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
                    <h1 class="m-0 mb-2 mb-md-0">Dashboard</h1>
                    <div class="d-flex flex-wrap align-items-center gap-2 dashboard-controls">
                        <button id="resetLayoutBtn" class="btn-reset-layout" data-toggle="tooltip" data-placement="bottom" title="Reset dashboard layout to default">
                            <i class="fas fa-th"></i>
                        </button>
                        <select id="timeFilter" class="form-control form-control-timefilter" data-toggle="tooltip" data-placement="bottom" title="Select time range for dashboard data">
                            <option value="5m">Last 5 minutes</option>
                            <option value="15m">Last 15 minutes</option>
                            <option value="30m">Last 30 minutes</option>
                            <option value="1h" selected>Last 1 hour</option>
                            <option value="3h">Last 3 hours</option>
                            <option value="6h">Last 6 hours</option>
                            <option value="12h">Last 12 hours</option>
                            <option value="24h">Last 24 hours</option>
                            <option value="7d">Last 7 days</option>
                            <option value="30d">Last 30 days</option>
                            <option value="60d">Last 60 days</option>
                            <option value="90d">Last 90 days</option>
                        </select>
                        <div class="refresh-control-group">
                            <button id="manualRefreshBtn" class="btn-refresh-icon" data-toggle="tooltip" data-placement="bottom" title="Refresh dashboard data manually">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <select id="refreshInterval" class="form-control-refresh" data-toggle="tooltip" data-placement="bottom" title="Set auto-refresh interval">
                                <option value="off">Off</option>
                                <option value="10s">10s</option>
                                <option value="30s">30s</option>
                                <option value="1m">1m</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- /.content-header -->

<!-- Main content -->
<section class="content">
    <div class="container-fluid" id="sortable-widgets-container">
        <!-- Overview Section -->
        <div class="row" id="widget-overview-metrics">
            <div class="col-md-12">
                <div class="card card-primary card-outline">
                    <div class="card-header draggable-header" data-toggle="tooltip" data-placement="top" title="Drag to reorder widgets">
                        <h3 class="card-title">Overview Metrics</h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse" data-toggle="tooltip" data-placement="left" title="Collapse/Expand">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body collapse show" id="overviewMetricsCollapse">
                        <div class="row">
                            <div class="col-lg-3 col-6" id="widget-total-requests" data-toggle="tooltip" data-placement="top" title="Total number of requests processed">
                                <div class="small-box bg-success">
                                    <div class="inner">
                                        <h3 id="totalRequests">0</h3>
                                        <p>Total Requests</p>
                                    </div>
                                    <div class="icon">
                                        <i class="fas fa-chart-bar"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-6" id="widget-error-rate" data-toggle="tooltip" data-placement="top" title="Percentage of failed requests">
                                <div class="small-box bg-warning">
                                    <div class="inner">
                                        <h3 id="errorRate">0<sup style="font-size: 20px">%</sup></h3>
                                        <p>Error Rate</p>
                                    </div>
                                    <div class="icon">
                                        <i class="fas fa-bug"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-6" id="widget-avg-latency" data-toggle="tooltip" data-placement="top" title="Average response time across all requests">
                                <div class="small-box bg-primary">
                                    <div class="inner">
                                        <h3 id="avgLatency">0<sup style="font-size: 20px">ms</sup></h3>
                                        <p>Avg Latency</p>
                                    </div>
                                    <div class="icon">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-6" id="widget-node-status" data-toggle="tooltip" data-placement="top" title="Current status of backend nodes">
                                <div class="small-box bg-info">
                                    <div class="inner">
                                        <h3 id="nodeStatusValue">0</h3>
                                        <p id="nodeStatusTitle"></p>
                                    </div>
                                    <div class="icon">
                                        <i class="fas fa-server"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-4" id="widget-request-timeline">
                <div class="card card-primary card-outline">
                    <div class="card-header draggable-header" data-toggle="tooltip" data-placement="top" title="Drag to reorder widgets">
                        <h3 class="card-title">Request Timeline</h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse" data-toggle="tooltip" data-placement="left" title="Collapse/Expand">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body collapse show" id="requestTimelineCollapse">
                        <canvas id="requestTimelineChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-4" id="widget-latency-timeline">
                <div class="card card-primary card-outline">
                    <div class="card-header draggable-header" data-toggle="tooltip" data-placement="top" title="Drag to reorder widgets">
                        <h3 class="card-title">Latency Timeline</h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse" data-toggle="tooltip" data-placement="left" title="Collapse/Expand">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body collapse show" id="latencyTimelineCollapse">
                        <canvas id="latencyTimelineChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-4" id="widget-http-status">
                <div class="card card-primary card-outline">
                    <div class="card-header draggable-header" data-toggle="tooltip" data-placement="top" title="Drag to reorder widgets">
                        <h3 class="card-title">HTTP Status</h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse" data-toggle="tooltip" data-placement="left" title="Collapse/Expand">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body collapse show" id="httpStatusCollapse">
                        <canvas id="httpStatusDonutChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Current Node Network Section -->
        <div class="row" id="widget-current-node-network">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header draggable-header" data-toggle="tooltip" data-placement="top" title="Drag to reorder widgets">
                        <h3 class="card-title">
                            Current Node Network
                            <span class="node-status-summary">
                                <span class="status-badge status-badge-healthy">
                                    <span class="status-dot"></span>
                                    <span id="networkHealthyNodeCount">0</span>
                                </span>
                                <span class="status-badge status-badge-unhealthy">
                                    <span class="status-dot"></span>
                                    <span id="networkUnhealthyNodeCount">0</span>
                                </span>
                            </span>
                        </h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse" data-toggle="tooltip" data-placement="left" title="Collapse/Expand">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body collapse show" id="currentNodeNetworkCollapse">
                        <div class="network-stats-bar">
                            <div class="network-stat-item">
                                <div class="stat-icon-mini gateway-mini">
                                    <i class="fas fa-network-wired"></i>
                                </div>
                                <div class="stat-info-mini">
                                    <div class="stat-value-mini" id="totalNodesCount">0</div>
                                    <div class="stat-label-mini">Total Nodes</div>
                                </div>
                            </div>
                            <div class="network-stat-item">
                                <div class="stat-icon-mini healthy-mini">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="stat-info-mini">
                                    <div class="stat-value-mini" id="healthyNodesCount">0</div>
                                    <div class="stat-label-mini">Healthy</div>
                                </div>
                            </div>
                            <div class="network-stat-item">
                                <div class="stat-icon-mini unhealthy-mini">
                                    <i class="fas fa-exclamation-circle"></i>
                                </div>
                                <div class="stat-info-mini">
                                    <div class="stat-value-mini" id="unhealthyNodesCount">0</div>
                                    <div class="stat-label-mini">Unhealthy</div>
                                </div>
                            </div>
                            <div class="network-stat-item">
                                <div class="stat-icon-mini requests-mini">
                                    <i class="fas fa-exchange-alt"></i>
                                </div>
                                <div class="stat-info-mini">
                                    <div class="stat-value-mini" id="totalRequestsAll">0</div>
                                    <div class="stat-label-mini">Total Requests</div>
                                </div>
                            </div>
                        </div>
                        <div id="nodeNetworkGraph" class="node-network-container"></div>
                        <div class="network-legend">
                            <div class="network-legend-item">
                                <div class="network-legend-icon gateway"></div>
                                <span>Gateway</span>
                            </div>
                            <div class="network-legend-item">
                                <div class="network-legend-icon healthy"></div>
                                <span>Healthy Connection</span>
                            </div>
                            <div class="network-legend-item">
                                <div class="network-legend-icon unhealthy"></div>
                                <span>Unhealthy Connection</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Current Node Status Section -->
        <div class="row" id="widget-current-node-status">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header draggable-header" data-toggle="tooltip" data-placement="top" title="Drag to reorder widgets">
                        <h3 class="card-title">
                            Current Node Status
                            <span class="node-status-summary">
                                <span class="status-badge status-badge-healthy">
                                    <span class="status-dot"></span>
                                    <span id="healthyNodeCount">0</span>
                                </span>
                                <span class="status-badge status-badge-unhealthy">
                                    <span class="status-dot"></span>
                                    <span id="unhealthyNodeCount">0</span>
                                </span>
                            </span>
                        </h3>
                        <div class="card-tools d-flex align-items-center">
                            <select id="nodeStatusFilter" class="form-control form-control-sm" style="width: 120px; margin-right: 10px;" data-toggle="tooltip" data-placement="left" title="Filter nodes by status">
                                <option value="all">All Nodes</option>
                                <option value="up">Up Only</option>
                                <option value="down">Down Only</option>
                            </select>
                            <button type="button" class="btn btn-tool" data-card-widget="collapse" data-toggle="tooltip" data-placement="left" title="Collapse/Expand">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body collapse show" id="currentNodeStatusCollapse">
                        <div class="table-responsive">
                            <table id="currentNodeStatusTable" class="table table-hover node-status-table">
                                <thead>
                                    <tr>
                                        <th style="width: 30px;" data-toggle="tooltip" title="Click row to expand details"></th>
                                        <th>Node</th>
                                        <th>Status</th>
                                        <th class="text-right">Total Requests</th>
                                        <th class="text-right">Avg Latency (ms)</th>
                                        <th class="text-right">Min Latency (ms)</th>
                                        <th class="text-right">Max Latency (ms)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Route Summary Section -->
        <div class="row" id="widget-route-summary">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header draggable-header" data-toggle="tooltip" data-placement="top" title="Drag to reorder widgets">
                        <h3 class="card-title">Route Summary</h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse" data-toggle="tooltip" data-placement="left" title="Collapse/Expand">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body collapse show" id="routeSummaryCollapse">
                        <div class="table-responsive">
                            <table id="routeSummaryTable" class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Route</th>
                                        <th class="text-right">Min Latency (ms)</th>
                                        <th class="text-right">Max Latency (ms)</th>
                                        <th class="text-right">Avg Latency (ms)</th>
                                        <th class="text-right">Total Requests</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Node Summary Section -->
        <div class="row" id="widget-node-summary">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header draggable-header" data-toggle="tooltip" data-placement="top" title="Drag to reorder widgets">
                        <h3 class="card-title">Node Summary</h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse" data-toggle="tooltip" data-placement="left" title="Collapse/Expand">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body collapse show" id="nodeSummaryCollapse">
                        <div class="table-responsive">
                            <table id="nodeSummaryTable" class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Node</th>
                                        <th class="text-right">Min Latency (ms)</th>
                                        <th class="text-right">Max Latency (ms)</th>
                                        <th class="text-right">Avg Latency (ms)</th>
                                        <th class="text-right">Total Requests</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Errors Section -->
        <div class="row" id="widget-recent-errors">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header draggable-header" data-toggle="tooltip" data-placement="top" title="Drag to reorder widgets">
                        <h3 class="card-title">Recent Errors (Last 100)</h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse" data-toggle="tooltip" data-placement="left" title="Collapse/Expand">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body collapse show" id="recentErrorsCollapse" style="max-height: 400px; overflow-y: auto;">
                        <div class="table-responsive">
                            <table id="recentErrorsTable" class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Time (UTC)</th>
                                        <th>Route</th>
                                        <th>Node</th>
                                        <th class="text-right">Latency (ms)</th>
                                        <th class="text-center">Status Code</th>
                                        <th>Error Message</th>
                                        <th>Request Body</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</section>

@section Scripts {
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chart.js Datalabels Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <!-- Vis.js Network -->
    <script src="https://cdn.jsdelivr.net/npm/vis-network@9.1.2/dist/vis-network.min.js"></script>
    <!-- Node Network Graph Component -->
    <link href="/css/node-network-graph.css" rel="stylesheet" />
    <script src="/js/node-network-graph.js"></script>
    <!-- Dashboard Script -->
    <script src="/js/dashboard.js"></script>
}
